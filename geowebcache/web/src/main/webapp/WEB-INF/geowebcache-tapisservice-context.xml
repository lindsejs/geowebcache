<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
  <description>
   Bean configuration file for the gwc-tapis module
  </description>
  
  <!-- controller for handling all tapis incoming requests -->
  <bean id="gwcTapisDispatcher" class="org.geowebcache.TapisDispatcher" destroy-method="destroy">
    <constructor-arg ref="gwcTLDispatcher"/>
    <constructor-arg ref="gwcStorageBroker"/>
    <constructor-arg ref="gwcXmlConfig"/>
    <constructor-arg ref="gwcRuntimeStats"/>
    <property name="defaultStorageFinder" ref="gwcDefaultStorageFinder"/>
  </bean>
  
  <!-- Tapis blob store -->
  <bean id="gwcFileTapisBlobStore" class="org.geowebcache.storage.tapis.FileTapisBlobStore" destroy-method="destroy">
    <constructor-arg ref="gwcDefaultStorageFinder" />
  </bean>
  
  <!-- Tapis XML storage broker -->
  <bean id="gwcTapisStorageBroker" class="org.geowebcache.storage.tapis.DefaultTapisStorageBroker" destroy-method="destroy">
    <constructor-arg ref="gwcFileTapisBlobStore" />
  </bean> 
  
  <!-- WMS based services -->
  <bean id="gwcWmsServiceTapis" class="org.geowebcache.service.tapis.wms.WMSService">
    <constructor-arg ref="gwcStorageBroker"/>
    <constructor-arg ref="gwcTapisStorageBroker"/>
    <constructor-arg ref="gwcTLDispatcher"/>
    <constructor-arg ref="gwcRuntimeStats"/>
    <constructor-arg ref="gwcURLMangler"/>
    <constructor-arg ref="gwcTapisDispatcher"/>
    <!-- Set the next line to true to enable full WMS support,
     i.e. recombining tiles to serve arbitrary WMS requests -->
    <property name="fullWMS"><value>FALSE</value></property>
    <!-- Proxy unknown requests -->
    <property name="proxyRequests"><value>TRUE</value></property>
  </bean>
  
  <!-- WMTS based services -->
  <bean id="gwcWmtsServiceTapis" class="org.geowebcache.service.tapis.wmts.WMTSService">
    <constructor-arg ref="gwcStorageBroker"/>
    <constructor-arg ref="gwcTapisStorageBroker"/>
    <constructor-arg ref="gwcTLDispatcher"/>
    <constructor-arg ref="gwcRuntimeStats"/>
    <constructor-arg ref="gwcURLMangler"/>
    <constructor-arg ref="gwcTapisDispatcher"/>
    <constructor-arg ref="gwcGridSetBroker"/>
  </bean>
  
  <!-- RESTlets -->
  <bean id="gwcTapisGetCapabilitiesRestlet" class="org.geowebcache.rest.tapis.GetCapabilitiesRestlet">
    <constructor-arg ref="gwcTapisStorageBroker"/>
    <constructor-arg ref="gwcTLDispatcher"/>
  </bean>
  
  <!-- REST Dispatcher -->
  <bean id="gwcTapisRestMappings" class="org.geowebcache.rest.RESTMapping">
    <property name="routes">
      <map>
        <entry>
          <key><value>/tapis/getcapabilities/{layer}</value></key>
          <ref bean="gwcTapisGetCapabilitiesRestlet" />
        </entry>
      </map>
    </property>
  </bean>
  
</beans>
